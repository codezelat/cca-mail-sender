<!DOCTYPE html>
<html lang="en" class="dark">
  <head>
    <meta charset="UTF-8" />
    <title>Login - Campaign Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Inter", sans-serif;
      }
    </style>
  </head>
  <body
    class="bg-black text-white min-h-screen flex flex-col items-center justify-center p-6 relative overflow-hidden font-sans antialiased selection:bg-purple-500/30"
  >
    <!-- Background Effects -->
    <div
      class="absolute top-0 left-0 w-full h-full overflow-hidden pointer-events-none z-0"
    >
      <div
        class="absolute top-[-10%] right-[-10%] w-[40%] h-[40%] bg-purple-600/20 blur-[120px] rounded-full mix-blend-screen animate-pulse"
      ></div>
      <div
        class="absolute bottom-[-10%] left-[-10%] w-[40%] h-[40%] bg-blue-600/10 blur-[120px] rounded-full mix-blend-screen animate-pulse"
        style="animation-delay: 2s"
      ></div>
    </div>

    <!-- Toast Container -->
    <div
      id="toast-container"
      class="fixed top-6 right-6 z-50 flex flex-col space-y-4 pointer-events-none"
    ></div>

    <div
      class="w-full max-w-md bg-gray-900/40 backdrop-blur-xl border border-white/10 rounded-2xl p-8 z-10 shadow-2xl relative overflow-hidden group"
    >
      <div
        class="absolute inset-0 bg-gradient-to-br from-white/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-700 pointer-events-none"
      ></div>

      <div class="text-center mb-8 relative">
        <div
          class="inline-flex items-center justify-center h-12 w-12 rounded-xl bg-gradient-to-tr from-purple-500 to-blue-500 mb-4 shadow-lg shadow-purple-500/20"
        >
          <svg
            class="w-6 h-6 text-white"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"
            ></path>
          </svg>
        </div>
        <h2
          class="text-3xl font-bold tracking-tight bg-clip-text text-transparent bg-gradient-to-b from-white to-white/60"
        >
          Welcome back
        </h2>
        <p class="text-gray-400 mt-2 text-sm">Sign in to your dashboard</p>
      </div>

      <form id="loginForm" class="space-y-5 relative">
        <div class="space-y-1.5">
          <label
            class="block text-xs font-medium text-gray-400 uppercase tracking-wider ml-1"
            >Email</label
          >
          <div class="relative group">
            <input
              type="email"
              id="email"
              required
              class="w-full bg-gray-950/50 border border-gray-800 rounded-xl px-4 py-3.5 text-white transition-all duration-200 outline-none focus:border-purple-500/50 focus:ring-4 focus:ring-purple-500/10 placeholder-gray-600 group-hover:border-gray-700"
              placeholder="name@company.com"
            />
          </div>
        </div>

        <div class="space-y-1.5">
          <label
            class="block text-xs font-medium text-gray-400 uppercase tracking-wider ml-1"
            >Password</label
          >
          <div class="relative group">
            <input
              type="password"
              id="password"
              required
              class="w-full bg-gray-950/50 border border-gray-800 rounded-xl px-4 py-3.5 text-white transition-all duration-200 outline-none focus:border-purple-500/50 focus:ring-4 focus:ring-purple-500/10 placeholder-gray-600 group-hover:border-gray-700"
              placeholder="••••••••"
            />
          </div>
        </div>

        <button
          type="submit"
          id="submitBtn"
          class="w-full bg-white text-black font-semibold h-12 rounded-xl hover:bg-gray-100 focus:ring-4 focus:ring-white/20 transition-all duration-200 mt-2 shadow-[0_0_20px_rgba(255,255,255,0.1)] hover:shadow-[0_0_25px_rgba(255,255,255,0.2)] transform active:scale-[0.98] disabled:opacity-70 disabled:cursor-not-allowed flex items-center justify-center group"
        >
          <span>Sign In</span>
          <svg
            class="w-4 h-4 ml-2 text-gray-400 group-hover:text-black transition-colors"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M14 5l7 7m0 0l-7 7m7-7H3"
            ></path>
          </svg>
        </button>
      </form>

      <div class="mt-8 text-center">
        <p class="text-sm text-gray-500">
          Don't have an account?
          <a
            href="/signup"
            class="text-white font-medium hover:text-purple-400 transition-colors inline-block hover:underline decoration-purple-500/50 underline-offset-4"
            >Sign up</a
          >
        </p>
      </div>
    </div>

    <script>
      // Toast Notification System
      function showToast(title, message, type = "success") {
        const container = document.getElementById("toast-container");
        const toast = document.createElement("div");

        const bgColor =
          type === "error"
            ? "bg-red-500/10 border-red-500/20"
            : "bg-green-500/10 border-green-500/20";
        const iconColor = type === "error" ? "text-red-400" : "text-green-400";
        const iconSvg =
          type === "error"
            ? '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />'
            : '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />';

        toast.className = `pointer-events-auto w-80 backdrop-blur-md border ${bgColor} rounded-xl p-4 shadow-2xl transform transition-all duration-500 translate-x-full opacity-0 flex items-start gap-3`;
        toast.innerHTML = `
          <div class="mt-0.5 shrink-0 ${iconColor}">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">${iconSvg}</svg>
          </div>
          <div class="flex-1">
            <h3 class="text-sm font-medium text-white">${title}</h3>
            <p class="text-sm text-gray-400 mt-1 leading-relaxed">${message}</p>
          </div>
        `;

        container.appendChild(toast);

        // Animate in
        requestAnimationFrame(() => {
          toast.classList.remove("translate-x-full", "opacity-0");
        });

        // Remove after 3s
        setTimeout(() => {
          toast.classList.add("translate-x-full", "opacity-0");
          setTimeout(() => toast.remove(), 500);
        }, 4000);
      }

      document
        .getElementById("loginForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          const btn = document.getElementById("submitBtn");
          const originalText = btn.innerHTML;

          // Loading State
          btn.disabled = true;
          btn.innerHTML = `<svg class="animate-spin h-5 w-5 text-black" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>`;

          const email = document.getElementById("email").value;
          const password = document.getElementById("password").value;

          const formData = new FormData();
          formData.append("username", email); // OAuth2 expects 'username'
          formData.append("password", password);

          try {
            const res = await fetch("/auth/token", {
              method: "POST",
              body: formData,
            });

            if (res.ok) {
              const data = await res.json();
              localStorage.setItem("token", data.access_token);
              showToast("Success", "Logged in successfully! Redirecting...");
              setTimeout(() => (window.location.href = "/dashboard"), 1000);
            } else {
              const err = await res.json();
              showToast(
                "Login Failed",
                err.detail || "Invalid credentials",
                "error"
              );
              btn.disabled = false;
              btn.innerHTML = originalText;
            }
          } catch (e) {
            showToast("Network Error", "Could not connect to server", "error");
            btn.disabled = false;
            btn.innerHTML = originalText;
          }
        });
    </script>
  </body>
</html>
